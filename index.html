<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kopkarindo Travel & PPOB</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        #root { width: 100%; min-height: 100%; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Card Shine Effect */
        .card-shine {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        }
    </style>
</head>
<body class="bg-slate-100 font-sans">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, memo, useRef } = React;

        const Icon = memo(({ name, size = 24, className = "" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide && ref.current) {
                    const element = document.createElement('i');
                    element.setAttribute('data-lucide', name);
                    element.setAttribute('width', size);
                    element.setAttribute('height', size);
                    if (className) element.setAttribute('class', className);
                    ref.current.innerHTML = '';
                    ref.current.appendChild(element);
                    window.lucide.createIcons({ root: ref.current });
                }
            }, [name, size, className]);
            return <span ref={ref} className="inline-flex items-center justify-center" style={{ width: size, height: size, verticalAlign: 'middle' }}></span>;
        });

        // Icon Definitions
        const Plane = (p) => <Icon name="plane" {...p} />;
        const Hotel = (p) => <Icon name="hotel" {...p} />;
        const CreditCard = (p) => <Icon name="credit-card" {...p} />;
        const Phone = (p) => <Icon name="phone" {...p} />;
        const MapPin = (p) => <Icon name="map-pin" {...p} />;
        const Instagram = (p) => <Icon name="instagram" {...p} />;
        const Wallet = (p) => <Icon name="wallet" {...p} />;
        const Bus = (p) => <Icon name="bus" {...p} />;
        const AlertCircle = (p) => <Icon name="alert-circle" {...p} />;
        const Sparkles = (p) => <Icon name="sparkles" {...p} />;
        const Send = (p) => <Icon name="send" {...p} />;
        const ArrowLeft = (p) => <Icon name="arrow-left" {...p} />;
        const Loader2 = (p) => <Icon name="loader-2" {...p} />;
        const User = (p) => <Icon name="user" {...p} />;
        const FileBadge = (p) => <Icon name="file-badge" {...p} />;
        const Zap = (p) => <Icon name="zap" {...p} />;
        const Wifi = (p) => <Icon name="wifi" {...p} />;
        const Droplets = (p) => <Icon name="droplets" {...p} />;
        const Smartphone = (p) => <Icon name="smartphone" {...p} />;
        const Ticket = (p) => <Icon name="ticket" {...p} />;
        const Briefcase = (p) => <Icon name="briefcase" {...p} />;
        const Calculator = (p) => <Icon name="calculator" {...p} />;
        const ChevronLeft = (p) => <Icon name="chevron-left" {...p} />;
        const ChevronRight = (p) => <Icon name="chevron-right" {...p} />;
        const CalendarIcon = (p) => <Icon name="calendar" {...p} />;
        const HistoryIcon = (p) => <Icon name="history" {...p} />;
        const Trash2 = (p) => <Icon name="trash-2" {...p} />;
        const IdCard = (p) => <Icon name="id-card" {...p} />;
        const QrCode = (p) => <Icon name="qr-code" {...p} />;
        const Building = (p) => <Icon name="building-2" {...p} />;

        const BackgroundDecor = memo(() => (
            <div className="absolute inset-0 overflow-hidden pointer-events-none z-0">
                <div className="absolute top-[5%] left-[5%] text-blue-200 opacity-20 -rotate-12"><Plane size={96} /></div>
                <div className="absolute top-[15%] right-[10%] text-red-200 opacity-20 rotate-12"><MapPin size={64} /></div>
                <div className="absolute bottom-[20%] left-[8%] text-yellow-200 opacity-20 -rotate-6"><Bus size={80} /></div>
                <div className="absolute bottom-[10%] right-[5%] text-purple-200 opacity-20 rotate-45"><Ticket size={96} /></div>
                <div className="absolute top-[40%] left-[2%] text-yellow-400 opacity-10"><Zap size={48} /></div>
                <div className="absolute top-[50%] right-[2%] text-blue-400 opacity-10"><Droplets size={48} /></div>
                <div className="absolute bottom-[40%] left-[15%] text-green-400 opacity-10"><Wifi size={40} /></div>
                <div className="absolute top-0 right-0 w-64 h-64 bg-blue-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
                <div className="absolute bottom-0 left-0 w-64 h-64 bg-yellow-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse delay-700"></div>
            </div>
        ));

        const CardWatermark = memo(() => (
            <div className="absolute inset-0 z-0 opacity-[0.03] overflow-hidden pointer-events-none flex flex-wrap content-start gap-8 p-4 justify-center">
                {[...Array(12)].map((_, i) => (
                    <div key={i} className="flex gap-8"><Plane size={32} /><Zap size={32} /><Hotel size={32} /><Droplets size={32} /><Briefcase size={32} /></div>
                ))}
            </div>
        ));

        const HOLIDAYS_2025 = {
            "1-1": "Tahun Baru 2025", "1-27": "Isra Mikraj", "1-29": "Tahun Baru Imlek", "3-29": "Hari Suci Nyepi", "3-31": "Idul Fitri 1446 H",
            "4-1": "Cuti Bersama Idul Fitri", "4-18": "Wafat Yesus Kristus", "5-1": "Hari Buruh", "5-12": "Hari Waisak", "5-29": "Kenaikan Yesus Kristus",
            "6-1": "Hari Lahir Pancasila", "6-6": "Idul Adha 1446 H", "6-27": "Tahun Baru Islam", "8-17": "HUT RI ke-80", "9-5": "Maulid Nabi Muhammad SAW", "12-25": "Hari Raya Natal"
        };

        const SITES = ["Office Adaro 73", "Kelanis", "Dahai", "Induksi", "Field Office"];

        function FlyerKopkrindo() {
            const [view, setView] = useState('flyer');
            const [name, setName] = useState('');
            const [nik, setNik] = useState('');
            const [kopkarId, setKopkarId] = useState('');
            const [siteLocation, setSiteLocation] = useState(''); // New State for Site
            
            // History State
            const [history, setHistory] = useState([]);

            // Planner State
            const [destination, setDestination] = useState('');
            const [days, setDays] = useState('');
            const [budget, setBudget] = useState('Standar');
            const [result, setResult] = useState('');
            const [loading, setLoading] = useState(false);
            
            // Other States
            const [billType, setBillType] = useState('Listrik'); 
            const [billNumber, setBillNumber] = useState('');
            const [bookingType, setBookingType] = useState('Pesawat');
            const [bookingDetails, setBookingDetails] = useState('');
            const [calcAmount, setCalcAmount] = useState('');

            const [currentDate, setCurrentDate] = useState(new Date());

            // Load Data & History
            useEffect(() => {
                const savedData = localStorage.getItem('kopkar_user_data');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    if (parsed.name) setName(parsed.name);
                    if (parsed.nik) setNik(parsed.nik);
                    if (parsed.kopkarId) setKopkarId(parsed.kopkarId);
                    if (parsed.siteLocation) setSiteLocation(parsed.siteLocation);
                }
                const savedHistory = localStorage.getItem('kopkar_history');
                if (savedHistory) {
                    setHistory(JSON.parse(savedHistory));
                }
            }, []);

            // Save User Data
            useEffect(() => {
                const userData = { name, nik, kopkarId, siteLocation };
                localStorage.setItem('kopkar_user_data', JSON.stringify(userData));
            }, [name, nik, kopkarId, siteLocation]);

            // Save History
            const saveToHistory = (type, details, amount = '-') => {
                const newItem = {
                    id: Date.now(),
                    date: new Date().toLocaleDateString('id-ID'),
                    type,
                    details,
                    amount
                };
                const newHistory = [newItem, ...history];
                setHistory(newHistory);
                localStorage.setItem('kopkar_history', JSON.stringify(newHistory));
            };

            const clearUserData = () => {
                if(confirm("Hapus semua data tersimpan dan riwayat?")) {
                    localStorage.removeItem('kopkar_user_data');
                    localStorage.removeItem('kopkar_history');
                    setName(''); setNik(''); setKopkarId(''); setSiteLocation(''); setHistory([]);
                    alert("Data berhasil dihapus.");
                }
            };

            const formatRupiah = (number) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(number);

            // --- Calendar Logic ---
            const getDaysInMonth = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const days = new Date(year, month + 1, 0).getDate();
                const firstDay = new Date(year, month, 1).getDay();
                return { days, firstDay, year, month };
            };

            const handlePrevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
            const handleNextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));

            const handleDateClick = (day, month, year, holidayName) => {
                if (holidayName) {
                    if (confirm(`ðŸ“… ${holidayName}\n\nIni tanggal merah! Mau rencanakan liburan untuk tanggal ini?`)) {
                        setDestination(`Liburan ${holidayName}`);
                        setDays('3'); 
                        setView('planner');
                    }
                }
            };

            const renderCalendar = () => {
                const { days, firstDay, year, month } = getDaysInMonth(currentDate);
                const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
                const dayNames = ["M", "S", "S", "R", "K", "J", "S"];
                let calendarDays = [];
                for (let i = 0; i < firstDay; i++) calendarDays.push(<div key={`empty-${i}`} className="h-8"></div>);
                for (let d = 1; d <= days; d++) {
                    const dateKey = `${month + 1}-${d}`;
                    const isHoliday = HOLIDAYS_2025[dateKey];
                    const isToday = new Date().getDate() === d && new Date().getMonth() === month && new Date().getFullYear() === year;
                    calendarDays.push(
                        <div key={d} onClick={() => handleDateClick(d, month, year, isHoliday)}
                            className={`h-8 flex items-center justify-center text-xs rounded-full cursor-pointer transition-all ${isHoliday ? 'bg-red-100 text-red-600 font-bold hover:bg-red-200 ring-1 ring-red-300' : ''} ${isToday ? 'bg-blue-600 text-white font-bold' : 'text-gray-700 hover:bg-gray-100'}`} title={isHoliday || ''}>
                            {d}
                        </div>
                    );
                }
                return (
                    <div className="bg-white rounded-lg border border-slate-200 p-3 shadow-sm mb-3">
                        <div className="flex justify-between items-center mb-2">
                            <button onClick={handlePrevMonth} className="p-1 hover:bg-slate-100 rounded"><ChevronLeft size={16} className="text-slate-500"/></button>
                            <span className="text-xs font-bold text-slate-700 flex items-center gap-1"><CalendarIcon size={14} className="text-blue-500"/> {monthNames[month]} {year}</span>
                            <button onClick={handleNextMonth} className="p-1 hover:bg-slate-100 rounded"><ChevronRight size={16} className="text-slate-500"/></button>
                        </div>
                        <div className="grid grid-cols-7 gap-1 mb-1 text-center">{dayNames.map((dn, idx) => (<div key={idx} className={`text-[10px] font-bold ${idx===0 ? 'text-red-500':'text-slate-400'}`}>{dn}</div>))}</div>
                        <div className="grid grid-cols-7 gap-1 text-center">{calendarDays}</div>
                        <div className="mt-2 pt-2 border-t border-dashed border-slate-200"><p className="text-[9px] text-slate-500 text-center italic">*Klik tanggal <span className="text-red-500 font-bold">MERAH</span> untuk merencanakan liburan!</p></div>
                    </div>
                );
            };

            // --- Logic Functions ---
            const generateOfflineItinerary = () => {
                const dur = parseInt(days);
                const dest = destination || "Destinasi Populer";
                let flightCost = 2000000; let dailyCost = 500000;
                if (budget === 'Hemat') { dailyCost = 350000; flightCost = 1500000; }
                if (budget === 'Mewah') { dailyCost = 1500000; flightCost = 3000000; }
                const lowerDest = dest.toLowerCase();
                if (lowerDest.includes('banjar') || lowerDest.includes('kalsel')) flightCost = 500000; 
                if (lowerDest.includes('jakarta') || lowerDest.includes('surabaya')) flightCost = 1800000;
                if (lowerDest.includes('bali') || lowerDest.includes('lombok')) flightCost = 2500000;
                const totalBiayaMurni = flightCost + (dailyCost * dur);
                const feeJasa = totalBiayaMurni * 0.05;
                const totalPinjaman = totalBiayaMurni + feeJasa;
                const tenor = totalPinjaman <= 10000000 ? 12 : 24;
                const angsuran = totalPinjaman / tenor;
                return `**ESTIMASI SISTEM (LOGIKA CERDAS):**\n\n1. **Tujuan**: ${dest} (${dur} Hari - ${budget})\n2. **Gambaran Biaya**:\n   - Transportasi (PP): Â± ${formatRupiah(flightCost)}\n   - Akomodasi & Saku: Â± ${formatRupiah(dailyCost)} x ${dur} hari\n   -----------------------------------\n   **Estimasi Total: ${formatRupiah(totalBiayaMurni)}**\n\n3. **SIMULASI KOPKARINDO**:\n   - Jasa Fee (5%): ${formatRupiah(feeJasa)}\n   - Total Pinjaman: ${formatRupiah(totalPinjaman)}\n   - Tenor: ${tenor} Bulan\n   ðŸ‘‰ **Angsuran: ${formatRupiah(angsuran)} /bulan**\n\n*Catatan: Ini adalah hitungan otomatis sistem.*`;
            };

            const generateItinerary = async () => {
                if (!days) return;
                setLoading(true);
                setResult('');
                const apiKey = ""; 
                if (!apiKey) {
                    await new Promise(r => setTimeout(r, 1000));
                    setResult(generateOfflineItinerary());
                    setLoading(false);
                    return;
                }
                const prompt = `Bertindaklah sebagai staf Kopkarindo. User ke: ${destination}. Durasi: ${days} hari. Budget: ${budget}. Berikan respon singkat: 1. Tujuan 2. Rencana Harian 3. Estimasi Biaya 4. Simulasi Kopkarindo (Jasa 5%).`;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                    const data = await response.json();
                    setResult(data.candidates?.[0]?.content?.parts?.[0]?.text || "Gagal memuat.");
                } catch (error) { setResult(generateOfflineItinerary()); } finally { setLoading(false); }
            };

            const sendTravelToWA = () => { 
                if (!name || !nik) { alert("Lengkapi Nama/NIK."); return; } 
                saveToHistory('Travel Planner', `${destination} (${days} Hari)`, 'Estimasi');
                window.open(`https://wa.me/6285248626532?text=${encodeURIComponent(`Halo Admin, Pinjaman Wisata:\nNama: ${name}\nNIK: ${nik}\nNo Anggota: ${kopkarId || '-'}\nLokasi: ${siteLocation || '-'}\n\n${result}`)}`, '_blank'); 
            };
            const sendBillToWA = () => { 
                if (!name || !nik || !billNumber) { alert("Lengkapi Data."); return; } 
                saveToHistory('PPOB', `${billType}: ${billNumber}`, '-');
                window.open(`https://wa.me/6285248626532?text=${encodeURIComponent(`Halo Admin, Bayar Tagihan:\nNama: ${name}\nNIK: ${nik}\nLokasi: ${siteLocation || '-'}\nJenis: ${billType}\nNomor: ${billNumber}`)}`, '_blank'); 
            };
            const sendBookingToWA = () => { 
                if (!name || !nik || !bookingDetails) { alert("Lengkapi Data."); return; } 
                saveToHistory('Booking', `${bookingType}`, 'Sesuai Tagihan');
                window.open(`https://wa.me/6285248626532?text=${encodeURIComponent(`Halo Admin, Pesan Tiket:\nNama: ${name}\nNIK: ${nik}\nLokasi: ${siteLocation || '-'}\nDetail: ${bookingDetails}`)}`, '_blank'); 
            };
            const sendCalcToWA = (p, f, t, ten, inst) => { 
                if (!name || !nik) { alert("Lengkapi Nama/NIK."); return; } 
                saveToHistory('Simulasi', `Pinjaman Tunai`, formatRupiah(t));
                window.open(`https://wa.me/6285248626532?text=${encodeURIComponent(`Halo Admin, Simulasi Pinjaman:\nNama: ${name}\nNIK: ${nik}\nLokasi: ${siteLocation || '-'}\nDana: ${formatRupiah(p)}\nTotal: ${formatRupiah(t)}\nAngsuran: ${formatRupiah(inst)} x ${ten} bulan`)}`, '_blank'); 
            }

            return (
                <div className="flex flex-col items-center min-h-screen w-full p-4 relative overflow-hidden">
                    <BackgroundDecor />
                    <div className="w-full max-w-md bg-white shadow-2xl rounded-xl overflow-hidden border border-gray-200 relative min-h-[600px] flex flex-col z-10 my-auto">
                        <CardWatermark />

                        {/* VIEW 1: FLYER UTAMA */}
                        {view === 'flyer' && (
                            <div className="flex-1 flex flex-col animate-fadeIn relative z-10">
                                <div className="bg-blue-900 p-6 text-white text-center relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-yellow-400 via-blue-900 to-black"></div>
                                    <div className="relative z-10 flex justify-center mb-4"><img src="https://i.ibb.co.com/8Df6kd0M/Untitled-design-1.png" alt="Logo" className="w-24 h-auto drop-shadow-lg"/></div>
                                    <div className="relative z-10 inline-block bg-yellow-500 text-blue-900 px-3 py-1 rounded-full text-[10px] font-bold mb-2 animate-pulse">SOLUSI DIGITAL ANGGOTA</div>
                                    <h1 className="text-2xl font-extrabold leading-tight mb-2 relative z-10">Liburan Puas, <br/> Tagihan Tuntas!</h1>
                                </div>

                                <div className="p-4 bg-white/80 backdrop-blur-sm flex-1 relative z-10">
                                    {renderCalendar()}

                                    <div className="grid grid-cols-1 gap-3">
                                        <div onClick={() => setView('booking')} className="flex items-center p-2 bg-indigo-50/90 rounded-lg border border-indigo-100 cursor-pointer hover:bg-indigo-100 transition-colors group shadow-sm">
                                            <div className="bg-indigo-100 p-2 rounded-full mr-3 group-hover:bg-white"><Ticket size={18} className="text-indigo-600" /></div>
                                            <div className="text-xs flex-1"><span className="font-bold text-gray-800 block flex justify-between">Tiket & Hotel <span className="bg-indigo-600 text-white px-1.5 py-0.5 rounded-full text-[9px]">Baru</span></span><span className="text-gray-500">Pesan Langsung (Fee Jasa 2%)</span></div>
                                        </div>
                                        <div onClick={() => setView('payment')} className="flex items-center p-2 bg-green-50/90 rounded-lg border border-green-100 cursor-pointer hover:bg-green-100 transition-colors group shadow-sm">
                                            <div className="bg-green-100 p-2 rounded-full mr-3 group-hover:bg-white"><Zap size={18} className="text-green-600" /></div>
                                            <div className="text-xs flex-1"><span className="font-bold text-gray-800 block flex justify-between">Bayar Tagihan <span className="bg-green-600 text-white px-1.5 py-0.5 rounded-full text-[9px]">PPOB</span></span><span className="text-gray-500">Listrik, Air, Pulsa (Jasa 1.5%)</span></div>
                                        </div>
                                        <div onClick={() => setView('calculator')} className="flex items-center p-2 bg-amber-50/90 rounded-lg border border-amber-100 cursor-pointer hover:bg-amber-100 transition-colors group shadow-sm">
                                            <div className="bg-amber-100 p-2 rounded-full mr-3 group-hover:bg-white"><Calculator size={18} className="text-amber-600" /></div>
                                            <div className="text-xs flex-1"><span className="font-bold text-gray-800 block flex justify-between">Simulasi Cicilan <span className="bg-amber-600 text-white px-1.5 py-0.5 rounded-full text-[9px]">Mandiri</span></span><span className="text-gray-500">Hitung angsuran pinjaman</span></div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div onClick={() => setView('card')} className="flex items-center p-2 bg-blue-50/90 rounded-lg border border-blue-100 cursor-pointer hover:bg-blue-100 transition-colors group shadow-sm">
                                                <div className="bg-blue-100 p-2 rounded-full mr-2 group-hover:bg-white"><IdCard size={16} className="text-blue-600" /></div>
                                                <div className="text-xs font-bold text-gray-800">Kartu Anggota</div>
                                            </div>
                                            <div onClick={() => setView('history')} className="flex items-center p-2 bg-slate-100 rounded-lg border border-slate-200 cursor-pointer hover:bg-slate-200 transition-colors group shadow-sm">
                                                <div className="bg-slate-200 p-2 rounded-full mr-2 group-hover:bg-white"><HistoryIcon size={16} className="text-slate-600" /></div>
                                                <div className="text-xs font-bold text-gray-800">Riwayat Saya</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div onClick={() => setView('planner')} className="mx-4 mb-4 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-4 text-white shadow-lg relative overflow-hidden group cursor-pointer z-10">
                                    <div className="absolute top-0 right-0 p-2 opacity-20"><Sparkles size={60} /></div>
                                    <div className="relative z-10">
                                        <h3 className="font-bold text-sm flex items-center gap-2"><Sparkles size={16} className="text-yellow-300" /> Bingung Mau Kemana?</h3>
                                        <p className="text-[11px] text-purple-100 mt-1 mb-3">Gunakan <strong>Smart Planner</strong>. Kami buatkan rencananya!</p>
                                        <button className="bg-white text-purple-700 text-xs font-bold py-2 px-4 rounded-full w-full">Coba Rencanakan Sekarang</button>
                                    </div>
                                </div>

                                <div className="bg-gray-900 p-4 mt-auto relative z-10">
                                    <button onClick={() => window.open('https://wa.me/6285248626532', '_blank')} className="w-full bg-yellow-500 text-blue-900 font-bold py-3 px-6 rounded-lg shadow-lg flex items-center justify-center space-x-2 text-sm"><Phone size={18} /><span>Chat WA: 0852-4862-6532</span></button>
                                </div>
                            </div>
                        )}

                        {/* VIEW: DIGITAL CARD */}
                        {view === 'card' && (
                            <div className="flex-1 flex flex-col bg-slate-50/95 h-full animate-fadeIn relative z-10">
                                <div className="bg-blue-800 p-4 text-white flex items-center shadow-md">
                                    <button onClick={() => setView('flyer')} className="mr-3 hover:bg-blue-700 p-1 rounded-full"><ArrowLeft size={20} /></button>
                                    <div className="flex-1"><h2 className="font-bold text-sm">Kartu Anggota Digital</h2></div>
                                </div>
                                <div className="p-6 flex flex-col items-center justify-center flex-1">
                                    {/* CARD DESIGN */}
                                    <div className="w-full bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 rounded-2xl shadow-2xl p-6 text-white relative overflow-hidden aspect-[1.58/1]">
                                        <div className="absolute top-0 right-0 w-40 h-40 bg-white opacity-5 rounded-full -translate-y-1/2 translate-x-1/3"></div>
                                        <div className="absolute bottom-0 left-0 w-32 h-32 bg-white opacity-5 rounded-full translate-y-1/3 -translate-x-1/3"></div>
                                        <div className="card-shine absolute inset-0"></div>
                                        
                                        <div className="relative z-10 h-full flex flex-col justify-between">
                                            <div className="flex justify-between items-start">
                                                <div className="flex items-center gap-2">
                                                    <img src="https://i.ibb.co.com/8Df6kd0M/Untitled-design-1.png" alt="Logo" className="w-10 h-auto brightness-200"/>
                                                    <div>
                                                        <div className="text-[8px] opacity-70 tracking-widest uppercase">Koperasi Karyawan</div>
                                                        <div className="text-xs font-bold tracking-wide">KOPKARINDO</div>
                                                    </div>
                                                </div>
                                                <QrCode size={32} className="opacity-80" />
                                            </div>
                                            
                                            <div className="mt-4">
                                                <div className="text-[10px] opacity-70 uppercase mb-1">Nama Anggota</div>
                                                <div className="text-lg font-bold tracking-wide truncate">{name || 'NAMA ANGGOTA'}</div>
                                                {siteLocation && <div className="text-[10px] opacity-80 mt-1 flex items-center gap-1"><MapPin size={10}/> {siteLocation}</div>}
                                            </div>

                                            <div className="flex justify-between items-end mt-2">
                                                <div>
                                                    <div className="text-[8px] opacity-70 uppercase">Nomor Anggota</div>
                                                    <div className="text-sm font-mono tracking-wider">{kopkarId || '000-000-000'}</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-[8px] opacity-70 uppercase">NIK</div>
                                                    <div className="text-sm font-mono">{nik || '---'}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <p className="text-center text-xs text-gray-500 mt-6 max-w-xs">
                                        Tunjukkan kartu digital ini untuk verifikasi keanggotaan atau klaim promo khusus di mitra Kopkarindo.
                                    </p>
                                    <button onClick={() => setView('history')} className="mt-8 text-blue-600 text-xs font-bold flex items-center gap-1 hover:underline">
                                        <User size={14}/> Ubah Data Profil
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* VIEW 6: HISTORY & SETTINGS */}
                        {view === 'history' && (
                            <div className="flex-1 flex flex-col bg-slate-50/95 h-full animate-fadeIn relative z-10">
                                <div className="bg-slate-700 p-4 text-white flex items-center shadow-md">
                                    <button onClick={() => setView('flyer')} className="mr-3 hover:bg-slate-600 p-1 rounded-full"><ArrowLeft size={20} /></button>
                                    <div className="flex-1"><h2 className="font-bold text-sm">Riwayat & Pengaturan</h2><p className="text-[10px] text-slate-300">Catatan aktivitas lokal Anda</p></div>
                                    <button onClick={clearUserData} className="p-2 bg-red-500 hover:bg-red-600 rounded-lg text-xs flex items-center gap-1 shadow"><Trash2 size={14}/> Reset</button>
                                </div>
                                <div className="p-4 space-y-3 overflow-y-auto">
                                    <div className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm">
                                        <div className="flex items-center gap-2 text-slate-800 mb-2 pb-2 border-b border-slate-100">
                                            <User size={14} /><h3 className="text-xs font-bold">Data Tersimpan</h3>
                                        </div>
                                        <div className="space-y-2">
                                            <input type="text" placeholder="Nama Lengkap" value={name} onChange={(e) => setName(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none bg-gray-50" />
                                            <div className="flex gap-2">
                                                <input type="text" placeholder="NIK" value={nik} onChange={(e) => setNik(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none bg-gray-50" />
                                                <input type="text" placeholder="No. Anggota" value={kopkarId} onChange={(e) => setKopkarId(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none bg-gray-50" />
                                            </div>
                                            <select value={siteLocation} onChange={(e) => setSiteLocation(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none bg-gray-50">
                                                <option value="">Pilih Lokasi Kerja...</option>
                                                {SITES.map(s => <option key={s} value={s}>{s}</option>)}
                                            </select>
                                            <p className="text-[9px] text-gray-400 italic text-right">*Data tersimpan otomatis di HP ini</p>
                                        </div>
                                    </div>

                                    <h3 className="text-xs font-bold text-slate-500 mt-2">Aktivitas Terakhir</h3>
                                    {history.length === 0 ? (
                                        <div className="text-center py-8 text-gray-400 text-xs italic">Belum ada riwayat pengajuan.</div>
                                    ) : (
                                        <div className="space-y-2">
                                            {history.map((item) => (
                                                <div key={item.id} className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm flex justify-between items-center">
                                                    <div>
                                                        <div className="text-[10px] text-gray-400 mb-1">{item.date} â€¢ {item.type}</div>
                                                        <div className="text-xs font-bold text-slate-800">{item.details}</div>
                                                    </div>
                                                    <div className="text-xs font-bold text-blue-600">{item.amount}</div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* VIEW 2: AI PLANNER */}
                        {view === 'planner' && (
                            <div className="flex-1 flex flex-col bg-gray-50/95 h-full animate-fadeIn relative z-10">
                                <div className="bg-purple-700 p-4 text-white flex items-center shadow-md">
                                    <button onClick={() => setView('flyer')} className="mr-3 hover:bg-purple-600 p-1 rounded-full"><ArrowLeft size={20} /></button>
                                    <div><h2 className="font-bold text-sm">Asisten Kopkarindo</h2><p className="text-[10px] text-purple-200">Rencanakan liburan & hitung budget</p></div>
                                </div>
                                <div className="p-4 space-y-3 overflow-y-auto">
                                    <div className="bg-white p-3 rounded-lg border border-purple-100 shadow-sm space-y-2">
                                        <div className="flex items-center gap-2 text-purple-800 mb-1"><User size={14} /><h3 className="text-xs font-bold">Data Karyawan</h3></div>
                                        <input type="text" placeholder="Nama Lengkap" value={name} onChange={(e) => setName(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none" />
                                        <div className="flex gap-2">
                                            <input type="text" placeholder="NIK" value={nik} onChange={(e) => setNik(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none" />
                                            <input type="text" placeholder="No. Anggota" value={kopkarId} onChange={(e) => setKopkarId(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none" />
                                        </div>
                                        <select value={siteLocation} onChange={(e) => setSiteLocation(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none bg-white">
                                            <option value="">Pilih Lokasi Kerja...</option>
                                            {SITES.map(s => <option key={s} value={s}>{s}</option>)}
                                        </select>
                                    </div>
                                    <div className="bg-white p-3 rounded-lg border border-gray-200 shadow-sm space-y-2">
                                        <div className="flex items-center gap-2 text-gray-700 mb-1"><MapPin size={14} /><h3 className="text-xs font-bold">Rencana Liburan</h3></div>
                                        <input type="text" placeholder="Tujuan (Contoh: Bali)" value={destination} onChange={(e) => setDestination(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none" />
                                        <div className="flex gap-2">
                                            <select value={days} onChange={(e) => setDays(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none bg-white"><option value="">Durasi...</option><option value="3">3 Hari</option><option value="4">4 Hari</option><option value="5">5 Hari</option></select>
                                            <select value={budget} onChange={(e) => setBudget(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none bg-white"><option value="Standar">Standar</option><option value="Hemat">Hemat</option><option value="Mewah">Sultan</option></select>
                                        </div>
                                    </div>
                                    <button onClick={generateItinerary} disabled={!days || loading} className={`w-full py-2 rounded-lg font-bold text-sm text-white flex justify-center items-center gap-2 ${!days ? 'bg-gray-300' : 'bg-purple-600 hover:bg-purple-700 shadow-md'}`}>
                                        {loading ? <span className="animate-spin"><Loader2 size={18}/></span> : <Sparkles size={18} />}
                                        {loading ? 'Menghitung...' : 'Buat Rencana'}
                                    </button>
                                    {result && (
                                        <div className="bg-white p-4 rounded-xl shadow border border-purple-100 text-xs text-gray-700 leading-relaxed whitespace-pre-wrap animate-fadeIn mt-2">
                                            <div className="flex items-center gap-2 mb-3 pb-2 border-b border-gray-100"><FileBadge size={16} className="text-green-600" /><span className="font-bold text-purple-900">Hasil Analisa:</span></div>
                                            {result}
                                            <div className="mt-4 pt-4 border-t border-dashed border-gray-300">
                                                <button onClick={sendTravelToWA} className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded-lg flex items-center justify-center gap-2 shadow"><Send size={16}/> Ajukan via WhatsApp</button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* VIEW 3: BOOKING MANUAL */}
                        {view === 'booking' && (
                            <div className="flex-1 flex flex-col bg-gray-50/95 h-full animate-fadeIn relative z-10">
                                <div className="bg-indigo-700 p-4 text-white flex items-center shadow-md">
                                    <button onClick={() => setView('flyer')} className="mr-3 hover:bg-indigo-600 p-1 rounded-full"><ArrowLeft size={20} /></button>
                                    <div><h2 className="font-bold text-sm">Pesan Tiket & Hotel</h2><p className="text-[10px] text-indigo-200">Fee Jasa hanya 2%</p></div>
                                </div>
                                <div className="p-4 space-y-4 overflow-y-auto">
                                    <div className="bg-white p-3 rounded-lg border border-indigo-200 shadow-sm space-y-2">
                                        <div className="flex items-center gap-2 text-indigo-800 mb-1"><User size={14} /><h3 className="text-xs font-bold">Data Pemesan</h3></div>
                                        <input type="text" placeholder="Nama Lengkap" value={name} onChange={(e) => setName(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none" />
                                        <div className="flex gap-2">
                                            <input type="text" placeholder="NIK" value={nik} onChange={(e) => setNik(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none" />
                                            <input type="text" placeholder="No. Anggota" value={kopkarId} onChange={(e) => setKopkarId(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none" />
                                        </div>
                                        <select value={siteLocation} onChange={(e) => setSiteLocation(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none bg-white">
                                            <option value="">Pilih Lokasi Kerja...</option>
                                            {SITES.map(s => <option key={s} value={s}>{s}</option>)}
                                        </select>
                                    </div>
                                    <div className="bg-white p-3 rounded-lg border border-indigo-200 shadow-sm space-y-3">
                                        <div className="flex items-center gap-2 text-indigo-800 mb-1"><Ticket size={14} /><h3 className="text-xs font-bold">Detail Pesanan</h3></div>
                                        <div className="grid grid-cols-3 gap-2">
                                            {['Pesawat', 'Hotel', 'Kereta'].map(t => (
                                                <button key={t} onClick={() => setBookingType(t)} className={`p-2 rounded-lg border text-xs font-bold ${bookingType===t?'bg-indigo-100 border-indigo-500 text-indigo-800':'bg-gray-50 text-gray-600'}`}>{t}</button>
                                            ))}
                                        </div>
                                        <textarea rows={4} placeholder="Contoh: Banjarmasin - Jakarta, 25 Des, Garuda." value={bookingDetails} onChange={(e) => setBookingDetails(e.target.value)} className="w-full p-3 text-xs border border-gray-300 rounded-lg outline-none resize-none"></textarea>
                                    </div>
                                    <button onClick={sendBookingToWA} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex items-center justify-center space-x-2 mt-4"><Send size={18} /><span>Kirim Pesanan</span></button>
                                </div>
                            </div>
                        )}

                        {/* VIEW 4: PAYMENT PPOB */}
                        {view === 'payment' && (
                            <div className="flex-1 flex flex-col bg-gray-50/95 h-full animate-fadeIn relative z-10">
                                <div className="bg-green-700 p-4 text-white flex items-center shadow-md">
                                    <button onClick={() => setView('flyer')} className="mr-3 hover:bg-green-600 p-1 rounded-full"><ArrowLeft size={20} /></button>
                                    <div><h2 className="font-bold text-sm">Layanan Pembayaran</h2><p className="text-[10px] text-green-200">Listrik, PDAM, Indihome (Jasa 1.5%)</p></div>
                                </div>
                                <div className="p-4 space-y-4 overflow-y-auto">
                                    <div className="bg-white p-3 rounded-lg border border-green-200 shadow-sm space-y-2">
                                        <div className="flex items-center gap-2 text-green-800 mb-1"><User size={14} /><h3 className="text-xs font-bold">Data Karyawan</h3></div>
                                        <input type="text" placeholder="Nama Lengkap" value={name} onChange={(e) => setName(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none" />
                                        <div className="flex gap-2">
                                            <input type="text" placeholder="NIK" value={nik} onChange={(e) => setNik(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none" />
                                            <input type="text" placeholder="No. Anggota" value={kopkarId} onChange={(e) => setKopkarId(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none" />
                                        </div>
                                        <select value={siteLocation} onChange={(e) => setSiteLocation(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none bg-white">
                                            <option value="">Pilih Lokasi Kerja...</option>
                                            {SITES.map(s => <option key={s} value={s}>{s}</option>)}
                                        </select>
                                    </div>
                                    <div className="bg-white p-3 rounded-lg border border-green-200 shadow-sm space-y-3">
                                        <div className="flex items-center gap-2 text-green-800 mb-1"><Zap size={14} /><h3 className="text-xs font-bold">Jenis Tagihan</h3></div>
                                        <div className="grid grid-cols-2 gap-2">
                                            {['Listrik', 'Indihome', 'PDAM', 'Pulsa'].map(t => (
                                                <button key={t} onClick={() => setBillType(t)} className={`p-3 rounded-lg border text-xs font-bold ${billType===t?'bg-green-100 border-green-500 text-green-800':'bg-gray-50 text-gray-600'}`}>{t}</button>
                                            ))}
                                        </div>
                                        <input type="text" placeholder="Nomor Pelanggan / ID" value={billNumber} onChange={(e) => setBillNumber(e.target.value)} className="w-full p-3 text-sm border border-gray-300 rounded-lg outline-none" />
                                    </div>
                                    <button onClick={sendBillToWA} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex items-center justify-center space-x-2 mt-4"><Send size={18} /><span>Kirim Tagihan</span></button>
                                </div>
                            </div>
                        )}

                        {/* VIEW 5: CALCULATOR */}
                        {view === 'calculator' && (
                            <div className="flex-1 flex flex-col bg-gray-50/95 h-full animate-fadeIn relative z-10">
                                <div className="bg-amber-600 p-4 text-white flex items-center shadow-md">
                                    <button onClick={() => setView('flyer')} className="mr-3 hover:bg-amber-500 p-1 rounded-full"><ArrowLeft size={20} /></button>
                                    <div><h2 className="font-bold text-sm">Simulasi Cicilan Mandiri</h2><p className="text-[10px] text-amber-100">Transparansi Finansial Anggota</p></div>
                                </div>
                                <div className="p-4 space-y-4 overflow-y-auto">
                                    <div className="bg-white p-3 rounded-lg border border-amber-200 shadow-sm space-y-2">
                                        <div className="flex items-center gap-2 text-amber-800 mb-1"><User size={14} /><h3 className="text-xs font-bold">Data Karyawan</h3></div>
                                        <input type="text" placeholder="Nama Lengkap" value={name} onChange={(e) => setName(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none" />
                                        <div className="flex gap-2">
                                            <input type="text" placeholder="NIK" value={nik} onChange={(e) => setNik(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none" />
                                            <input type="text" placeholder="No. Anggota" value={kopkarId} onChange={(e) => setKopkarId(e.target.value)} className="flex-1 p-2 text-xs border border-gray-300 rounded outline-none" />
                                        </div>
                                        <select value={siteLocation} onChange={(e) => setSiteLocation(e.target.value)} className="w-full p-2 text-xs border border-gray-300 rounded outline-none bg-white">
                                            <option value="">Pilih Lokasi Kerja...</option>
                                            {SITES.map(s => <option key={s} value={s}>{s}</option>)}
                                        </select>
                                    </div>
                                    <div className="bg-white p-4 rounded-lg border border-amber-200 shadow-sm space-y-3">
                                        <div className="flex items-center gap-2 text-amber-800 mb-1"><Wallet size={14} /><h3 className="text-xs font-bold">Berapa Dana Yang Dibutuhkan?</h3></div>
                                        <input type="number" placeholder="Contoh: 5000000" value={calcAmount} onChange={(e) => setCalcAmount(e.target.value)} className="w-full p-3 text-lg font-bold text-gray-700 border border-amber-300 rounded-lg outline-none focus:ring-2 focus:ring-amber-500" />
                                        <p className="text-[10px] text-gray-500 italic">*Masukkan nominal tanpa titik/koma</p>
                                    </div>
                                    {calcAmount && !isNaN(calcAmount) && calcAmount > 0 ? (() => {
                                        const principal = parseFloat(calcAmount);
                                        const fee = principal * 0.05; 
                                        const total = principal + fee;
                                        const tenor = principal <= 10000000 ? 12 : 24;
                                        const installment = total / tenor;
                                        return (
                                            <div className="bg-white p-4 rounded-xl shadow border border-amber-200 animate-fadeIn">
                                                <h3 className="text-xs font-bold text-gray-700 border-b border-gray-100 pb-2 mb-2">Rincian Angsuran</h3>
                                                <div className="space-y-2 text-xs">
                                                    <div className="flex justify-between"><span>Pokok Pinjaman:</span> <span className="font-medium">{formatRupiah(principal)}</span></div>
                                                    <div className="flex justify-between text-amber-600"><span>Jasa Fee (5%):</span> <span className="font-medium">+ {formatRupiah(fee)}</span></div>
                                                    <div className="flex justify-between font-bold text-gray-900 pt-2 border-t border-dashed"><span>Total Pinjaman:</span> <span>{formatRupiah(total)}</span></div>
                                                    <div className="flex justify-between items-center bg-amber-50 p-2 rounded mt-2">
                                                        <span className="text-amber-800 font-bold">Cicilan / Bulan:</span>
                                                        <div className="text-right">
                                                            <span className="block text-lg font-bold text-amber-700">{formatRupiah(installment)}</span>
                                                            <span className="text-[9px] text-gray-500">Selama {tenor} Bulan</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button onClick={() => sendCalcToWA(principal, fee, total, tenor, installment)} className="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex items-center justify-center space-x-2 mt-4"><Send size={18} /><span>Ajukan Sekarang</span></button>
                                            </div>
                                        );
                                    })() : ( <div className="text-center text-gray-400 py-4 text-xs">Masukkan nominal untuk melihat simulasi angsuran.</div> )}
                                </div>
                            </div>
                        )}

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FlyerKopkrindo />);
    </script>
</body>
</html>
